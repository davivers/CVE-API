import requests
from requests_html import HTMLSession
import pprint
#MADE BY DAVID APOLINARIO 10/05/2022

#search CVE
try:
    cveBy = input('Insert your CVE ID or Search by Name: \n ex; CVE-2021-41172 or PHP 7.3 : ')
    inputFormat = cveBy.replace(" ","+").capitalize
    if cveBy.isalnum and "CVE" in cveBy:
        url ='https://services.nvd.nist.gov/rest/json/cve/1.0/'+cveBy+'?addOns=dictionaryCpes?apiKey=keyvalue'
        #api integration
        response = requests.get(url)
        pprint.pprint(response.json())
    else:
        print('Not a valid cve id \nSearching on DataBase . . .')
        session = HTMLSession()
#search databse for cve
        responseS = session.get('https://nvd.nist.gov/vuln/search/results?form_type=Basic&results_type=overview&query='+cveBy+'&search_type=all&isCpeNameSearch=false')
        findCve = responseS.html.find('#row > table > tbody > tr:nth-child(1) > th > strong > a', first=True)
        found = str(findCve).strip("Element < , 'a' href='/vuln/detail/ a 'data-testid='vuln-detail-link-0' ' data-testid='vuln-detail-link-0'>")
        print("CVE FOUND: "+found)
#api integration
        url ='https://services.nvd.nist.gov/rest/json/cve/1.0/'+found+'?addOns=dictionaryCpes?apiKey=keyvalue'
        response = requests.get(url)
#parse json to dict
        jsonResponse = response.json()
        jsonToList = jsonResponse['result']
        print (jsonToList)
        input()

except:
       print("Error")